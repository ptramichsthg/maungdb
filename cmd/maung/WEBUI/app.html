<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MaungDB Studio</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
          colors: {
            maung: {
              50: '#fff7ed',
              100: '#ffedd5',
              500: '#f97316',
              600: '#ea580c',
              700: '#c2410c',
              900: '#7c2d12',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-out',
            'pop-in': 'popIn 0.2s ease-out',
            'slide-up': 'slideUp 0.3s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(5px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            popIn: {
              '0%': { opacity: '0', transform: 'scale(0.95)' },
              '100%': { opacity: '1', transform: 'scale(1)' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gray-100 text-gray-900 h-screen overflow-hidden font-sans">

  <!-- Overlay for mobile sidebar -->
  <div class="hidden fixed inset-0 bg-black/50 z-40 overlay" onclick="toggleSidebar()"></div>

  <div class="flex h-screen relative">

    <!-- Sidebar -->
    <aside
      class="w-64 bg-slate-800 text-slate-400 flex flex-col h-full fixed left-0 top-0 z-50 transition-transform duration-300 ease-in-out md:relative md:translate-x-0 -translate-x-full sidebar">
      <div
        class="h-16 flex items-center justify-center px-5 border-b border-white/10 text-white font-bold text-lg tracking-tight">
        <span class="mr-2.5"><i data-lucide="cat" class="w-6 h-6 inline-block text-amber-500"></i></span>
        MaungDB Studio
      </div>

      <div class="px-5 py-5 border-b border-white/5 mb-2.5 flex flex-col items-center text-center">
        <div class="w-9 h-9 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold mb-2">M
        </div>
        <div class="text-white font-semibold text-sm" id="userName">User</div>
        <div class="text-xs uppercase tracking-wider mt-0.5" id="userRole">Connecting...</div>
      </div>

      <nav class="flex-1 px-2.5 flex flex-col gap-1">
        <div
          class="nav-item active px-3.5 py-2.5 rounded-md cursor-pointer flex items-center gap-3 transition-all font-medium text-sm hover:bg-white/5 hover:text-white"
          onclick="switchTab('dashboard')">
          <span><i data-lucide="layout-dashboard" class="w-4 h-4 inline-block"></i></span> Dashboard
        </div>
        <div
          class="nav-item px-3.5 py-2.5 rounded-md cursor-pointer flex items-center gap-3 transition-all font-medium text-sm hover:bg-white/5 hover:text-white"
          onclick="switchTab('database')">
          <span><i data-lucide="database" class="w-4 h-4 inline-block"></i></span> Database Manager
        </div>
        <div
          class="nav-item px-3.5 py-2.5 rounded-md cursor-pointer flex items-center gap-3 transition-all font-medium text-sm hover:bg-white/5 hover:text-white"
          onclick="switchTab('query')">
          <span><i data-lucide="terminal-square" class="w-4 h-4 inline-block"></i></span> Query Console
        </div>
        <div
          class="nav-item px-3.5 py-2.5 rounded-md cursor-pointer flex items-center gap-3 transition-all font-medium text-sm hover:bg-white/5 hover:text-white"
          onclick="switchTab('schema')">
          <span><i data-lucide="table-properties" class="w-4 h-4 inline-block"></i></span> Table Designer
        </div>
      </nav>

      <div class="px-5 py-5 border-t border-white/10">
        <button onclick="logout()"
          class="w-full py-2.5 bg-transparent border border-white/20 text-slate-400 rounded-md cursor-pointer transition-all hover:border-white hover:text-white">Sign
          Out</button>
      </div>
    </aside>

    <div class="flex-1 flex flex-col overflow-hidden w-full">

      <!-- Header -->
      <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 sticky top-0 z-30">
        <div class="flex items-center gap-4">
          <button class="menu-btn md:hidden bg-transparent border-0 cursor-pointer text-2xl text-gray-900 p-0"
            onclick="toggleSidebar()">
            <i data-lucide="menu" class="w-5 h-5"></i>
          </button>
          <div
            class="flex items-center gap-2 bg-blue-50 text-indigo-800 px-3 py-1.5 rounded-full text-sm font-semibold max-w-[200px] whitespace-nowrap overflow-hidden text-ellipsis">
            <div class="w-2 h-2 bg-gray-300 rounded-full dot" id="dbIndicator"></div>
            <span id="activeDBName">No Database Selected</span>
          </div>
        </div>
        <div class="text-sm text-gray-500 server-version">Server v1.0.0</div>
      </header>

      <div class="flex-1 p-6 overflow-y-auto">

        <!-- Dashboard Tab -->
        <div id="tab-dashboard" class="tool-panel block animate-fade-in space-y-6">
          <div class="flex items-end justify-between mb-2">
            <div>
              <h2 class="text-2xl font-bold text-slate-800 tracking-tight m-0">Dashboard Overview</h2>
              <p class="text-slate-500 text-sm mt-1">Real-time metrics and system status.</p>
            </div>
            <div class="flex gap-2">
              <span class="text-xs text-slate-400 font-mono bg-white px-2 py-1 rounded border">Last updated: Just
                now</span>
            </div>
          </div>

          <!-- Stats Grid -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div
              class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow group relative overflow-hidden">
              <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <i data-lucide="database" class="w-16 h-16 text-indigo-600"></i>
              </div>
              <div class="text-slate-500 text-sm font-medium uppercase tracking-wider mb-1">Total Tables</div>
              <div class="text-3xl font-bold text-slate-800" id="statTables">0</div>
              <div class="mt-4 flex items-center text-xs text-emerald-600 font-medium">
                <i data-lucide="trending-up" class="w-3 h-3 mr-1"></i> Active
              </div>
            </div>

            <div
              class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow group relative overflow-hidden">
              <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <i data-lucide="activity" class="w-16 h-16 text-amber-500"></i>
              </div>
              <div class="text-slate-500 text-sm font-medium uppercase tracking-wider mb-1">Queries Executed</div>
              <div class="text-3xl font-bold text-slate-800" id="statQueries">0</div>
              <div class="mt-4 flex items-center text-xs text-indigo-600 font-medium cursor-pointer hover:underline"
                onclick="switchTab('query')">
                View console →
              </div>
            </div>

            <div
              class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow group relative overflow-hidden">
              <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <i data-lucide="server" class="w-16 h-16 text-emerald-600"></i>
              </div>
              <div class="text-slate-500 text-sm font-medium uppercase tracking-wider mb-1">System Status</div>
              <div class="text-3xl font-bold text-emerald-600">OK</div>
              <div class="mt-4 flex items-center text-xs text-slate-400 font-mono">
                Uptime: 99.9%
              </div>
            </div>
          </div>

          <!-- Charts Area -->
          <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2 mt-0">
              <i data-lucide="bar-chart-3" class="w-5 h-5 text-indigo-600"></i>
              Storage Utilization
            </h3>
            <div class="h-64 flex items-end justify-between gap-4 px-2">
              <div
                class="chart-col w-full bg-indigo-50 rounded-t-lg hover:bg-indigo-100 transition-all relative group flex flex-col justify-end"
                style="height: 30%;">
                <div
                  class="w-full bg-indigo-500 rounded-t-lg h-full opacity-80 group-hover:opacity-100 transition-opacity">
                </div>
                <span
                  class="absolute -bottom-6 left-0 right-0 text-center text-xs text-slate-500 font-medium">Users</span>
              </div>
              <div
                class="chart-col w-full bg-indigo-50 rounded-t-lg hover:bg-indigo-100 transition-all relative group flex flex-col justify-end"
                style="height: 65%;">
                <div
                  class="w-full bg-purple-500 rounded-t-lg h-full opacity-80 group-hover:opacity-100 transition-opacity">
                </div>
                <span
                  class="absolute -bottom-6 left-0 right-0 text-center text-xs text-slate-500 font-medium">Txns</span>
              </div>
              <div
                class="chart-col w-full bg-indigo-50 rounded-t-lg hover:bg-indigo-100 transition-all relative group flex flex-col justify-end"
                style="height: 45%;">
                <div
                  class="w-full bg-amber-500 rounded-t-lg h-full opacity-80 group-hover:opacity-100 transition-opacity">
                </div>
                <span
                  class="absolute -bottom-6 left-0 right-0 text-center text-xs text-slate-500 font-medium">Logs</span>
              </div>
              <div
                class="chart-col w-full bg-indigo-50 rounded-t-lg hover:bg-indigo-100 transition-all relative group flex flex-col justify-end"
                style="height: 80%;">
                <div
                  class="w-full bg-emerald-500 rounded-t-lg h-full opacity-80 group-hover:opacity-100 transition-opacity">
                </div>
                <span
                  class="absolute -bottom-6 left-0 right-0 text-center text-xs text-slate-500 font-medium">Cache</span>
              </div>
              <div
                class="chart-col w-full bg-indigo-50 rounded-t-lg hover:bg-indigo-100 transition-all relative group flex flex-col justify-end"
                style="height: 60%;">
                <div
                  class="w-full bg-rose-500 rounded-t-lg h-full opacity-80 group-hover:opacity-100 transition-opacity">
                </div>
                <span
                  class="absolute -bottom-6 left-0 right-0 text-center text-xs text-slate-500 font-medium">Data</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Database Tab -->
        <div id="tab-database" class="tool-panel hidden space-y-6">
          <div class="flex items-end justify-between mb-2">
            <div>
              <h2 class="text-2xl font-bold text-slate-800 tracking-tight m-0">Database Manager</h2>
              <p class="text-slate-500 text-sm mt-1">Manage, switch, or create new databases.</p>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Switch Database Card -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
              <div class="flex items-center gap-3 mb-6">
                <div class="p-2 bg-indigo-50 rounded-lg">
                  <i data-lucide="database" class="w-6 h-6 text-indigo-600"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800 m-0">Switch Database</h3>
              </div>

              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-1">Database Name</label>
                  <input type="text" id="useDbName" placeholder="e.g., kampus"
                    class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-sm">
                </div>
                <button onclick="doUseDB()"
                  class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2">
                  <i data-lucide="arrow-right-left" class="w-4 h-4"></i> Switch Database
                </button>
                <div id="useDbAlert" class="mt-2"></div>
              </div>
            </div>

            <!-- Create Database Card -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
              <div class="flex items-center gap-3 mb-6">
                <div class="p-2 bg-emerald-50 rounded-lg">
                  <i data-lucide="plus-circle" class="w-6 h-6 text-emerald-600"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800 m-0">Create New Database</h3>
              </div>

              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-slate-700 mb-1">New Database Name</label>
                  <input type="text" id="newDbName" placeholder="e.g., inventory_system"
                    class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all text-sm">
                </div>
                <button onclick="doCreateDB()"
                  class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2">
                  <i data-lucide="plus" class="w-4 h-4"></i> Create Database
                </button>
                <div id="createDbAlert" class="mt-2"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Query Tab -->
        <!-- Query Tab -->
        <div id="tab-query" class="tool-panel hidden">
          <div class="flex items-center gap-3 mb-6">
            <div class="p-2 bg-indigo-50 rounded-lg">
              <i data-lucide="terminal-square" class="w-6 h-6 text-indigo-600"></i>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-slate-800 m-0">Konsol Paréntah</h2>
              <p class="text-slate-500 text-sm mt-1">Jalankeun paréntah MaungQL sacara langsung.</p>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-[1fr_300px] gap-6">
            <div class="flex flex-col">
              <div class="relative group">
                <textarea id="queryInput"
                  class="w-full h-[250px] rounded-t-xl font-mono bg-slate-900 text-indigo-100 border-0 p-5 leading-relaxed resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 shadow-inner text-sm"
                  placeholder="Ketik paréntah MaungQL di dieu...
Conto: TINGALI pegawai"></textarea>
                <div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
                  <span class="text-xs text-slate-500 font-mono">MaungQL Édit</span>
                </div>
              </div>
              <button onclick="runQuery()"
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-b-xl transition-colors flex items-center justify-center gap-2 shadow-sm active:transform active:scale-[0.99]">
                <i data-lucide="play" class="w-4 h-4 fill-current"></i>
                Jalankeun
              </button>

              <div id="queryOutput" class="mt-6"></div>
            </div>

            <div class="bg-white border border-slate-200 rounded-xl shadow-sm flex flex-col h-[500px]">
              <div class="p-4 border-b border-slate-100 bg-slate-50 rounded-t-xl">
                <h4 class="m-0 text-indigo-700 font-bold flex items-center gap-2">
                  <i data-lucide="book-open" class="w-4 h-4"></i>
                  Kamus MaungQL v2
                </h4>
              </div>

              <div class="p-5 overflow-y-auto custom-scrollbar flex-1">

                <div class="group cursor-pointer pb-3 mb-3 border-b border-dashed border-slate-200"
                  onclick="copyToQuery('TINGALI ')">
                  <span
                    class="inline-block bg-indigo-50 text-indigo-700 px-2 py-1 rounded text-xs font-mono font-bold border border-indigo-100 group-hover:bg-indigo-100 transition-colors mb-1">TINGALI
                    &lt;tbl&gt;</span>
                  <div class="text-xs text-slate-500">Ningali data (SELECT)</div>
                </div>

                <div class="group cursor-pointer pb-3 mb-3 border-b border-dashed border-slate-200"
                  onclick="copyToQuery('SIMPEN ')">
                  <span
                    class="inline-block bg-indigo-50 text-indigo-700 px-2 py-1 rounded text-xs font-mono font-bold border border-indigo-100 group-hover:bg-indigo-100 transition-colors mb-1">SIMPEN
                    &lt;tbl&gt; val|val</span>
                  <div class="text-xs text-slate-500">Nambah data (INSERT)</div>
                </div>

                <div class="group cursor-pointer pb-3 mb-3 border-b border-dashed border-slate-200"
                  onclick="copyToQuery('OMEAN ')">
                  <span
                    class="inline-block bg-indigo-50 text-indigo-700 px-2 py-1 rounded text-xs font-mono font-bold border border-indigo-100 group-hover:bg-indigo-100 transition-colors mb-1">OMEAN
                    &lt;tbl&gt; JADI c=v</span>
                  <div class="text-xs text-slate-500">Ngubah data (UPDATE)</div>
                </div>

                <div class="group cursor-pointer pb-3 mb-3 border-b border-dashed border-slate-200"
                  onclick="copyToQuery('MICEUN TI ')">
                  <span
                    class="inline-block bg-indigo-50 text-indigo-700 px-2 py-1 rounded text-xs font-mono font-bold border border-indigo-100 group-hover:bg-indigo-100 transition-colors mb-1">MICEUN
                    TI &lt;tbl&gt;</span>
                  <div class="text-xs text-slate-500">Miceun data (DELETE)</div>
                </div>

                <div class="group cursor-pointer pb-3 mb-3 border-b border-dashed border-slate-200"
                  onclick="copyToQuery('DIMANA ')">
                  <span
                    class="inline-block bg-amber-50 text-amber-700 px-2 py-1 rounded text-xs font-mono font-bold border border-amber-100 group-hover:bg-amber-100 transition-colors mb-1">DIMANA
                    col = val</span>
                  <div class="text-xs text-slate-500">Kaayaan (WHERE)</div>
                </div>

                <div class="group cursor-pointer pb-3 mb-3 border-b border-dashed border-slate-200"
                  onclick="copyToQuery('SARENG ')">
                  <span
                    class="inline-block bg-amber-50 text-amber-700 px-2 py-1 rounded text-xs font-mono font-bold border border-amber-100 group-hover:bg-amber-100 transition-colors mb-1">SARENG
                    / ATAWA</span>
                  <div class="text-xs text-slate-500">Sareng / Atawa (AND / OR)</div>
                </div>

                <div class="group cursor-pointer pb-3 mb-3 border-b border-dashed border-slate-200"
                  onclick="copyToQuery('RUNTUYKEUN ')">
                  <span
                    class="inline-block bg-indigo-50 text-indigo-700 px-2 py-1 rounded text-xs font-mono font-bold border border-indigo-100 group-hover:bg-indigo-100 transition-colors mb-1">RUNTUYKEUN
                    &lt;col&gt;</span>
                  <div class="text-xs text-slate-500">Runtuyan (ORDER BY)</div>
                </div>

                <div class="group cursor-pointer pb-3 mb-3 border-b border-dashed border-slate-200"
                  onclick="copyToQuery('SAKADAR ')">
                  <span
                    class="inline-block bg-indigo-50 text-indigo-700 px-2 py-1 rounded text-xs font-mono font-bold border border-indigo-100 group-hover:bg-indigo-100 transition-colors mb-1">SAKADAR
                    &lt;n&gt;</span>
                  <div class="text-xs text-slate-500">Batasan (LIMIT)</div>
                </div>

                <div class="mb-4 pt-2">
                  <h5 class="text-xs font-bold text-slate-700 mb-2">Tipe Data</h5>
                  <p
                    class="text-xs font-mono text-slate-600 leading-relaxed bg-slate-50 p-2 rounded border border-slate-100 tracking-wide">
                    INT, FLOAT, BOOL, STRING, TEXT, DATE, CHAR(n), ENUM(a,b)
                  </p>
                </div>

                <div class="border-t border-dashed border-slate-200 pt-4 mt-4">
                  <h5 class="text-indigo-600 font-bold mb-3 flex items-center gap-2 text-sm">
                    <i data-lucide="cat" class="w-4 h-4"></i> Conto Kueri
                  </h5>
                </div>

                <div class="mb-4">
                  <div class="text-xs font-bold text-slate-700 mb-1">1. Damel Tabel</div>
                  <div class="group relative">
                    <div
                      class="cursor-pointer text-xs bg-orange-50 text-orange-800 border border-orange-200 px-2 py-2 rounded font-mono font-semibold hover:bg-orange-100 transition-colors break-all leading-relaxed"
                      onclick="copyToQuery(this.innerText)">DAMEL pegawai
                      id:INT,nama:STRING,kelamin:ENUM(PRIA,WANITA),gaji:FLOAT,divisi:STRING,tgl_masuk:DATE</div>
                  </div>
                </div>

                <div class="mb-4">
                  <div class="text-xs font-bold text-slate-700 mb-1">2. Nambah Data</div>
                  <div
                    class="cursor-pointer text-xs bg-slate-100 text-slate-700 border border-slate-200 px-2 py-2 rounded font-mono font-semibold hover:bg-slate-200 transition-colors break-all leading-relaxed"
                    onclick="copyToQuery(this.innerText)">SIMPEN pegawai 101|Asep|PRIA|5500000|IT|2023-01-10</div>
                </div>

                <div class="mb-4">
                  <div class="text-xs font-bold text-slate-700 mb-1">3. Filter & Logika</div>
                  <div
                    class="cursor-pointer text-xs bg-slate-100 text-slate-700 border border-slate-200 px-2 py-2 rounded font-mono font-semibold hover:bg-slate-200 transition-colors break-all leading-relaxed"
                    onclick="copyToQuery(this.innerText)">TINGALI pegawai DIMANA kelamin = WANITA SARENG gaji > 5000000
                  </div>
                </div>

                <div class="mb-4">
                  <div class="text-xs font-bold text-slate-700 mb-1">4. Milarian (Like)</div>
                  <div
                    class="cursor-pointer text-xs bg-slate-100 text-slate-700 border border-slate-200 px-2 py-2 rounded font-mono font-semibold hover:bg-slate-200 transition-colors break-all leading-relaxed"
                    onclick="copyToQuery(this.innerText)">TINGALI pegawai DIMANA nama JIGA sep</div>
                </div>

                <div class="mb-4">
                  <div class="text-xs font-bold text-slate-700 mb-1">5. Runtuyan</div>
                  <div
                    class="cursor-pointer text-xs bg-slate-100 text-slate-700 border border-slate-200 px-2 py-2 rounded font-mono font-semibold hover:bg-slate-200 transition-colors break-all leading-relaxed"
                    onclick="copyToQuery(this.innerText)">TINGALI pegawai RUNTUYKEUN gaji TI_LUHUR SAKADAR 3</div>
                </div>

                <div class="mb-4">
                  <div class="text-xs font-bold text-slate-700 mb-1">6. Ngarobih Data</div>
                  <div
                    class="cursor-pointer text-xs bg-slate-100 text-slate-700 border border-slate-200 px-2 py-2 rounded font-mono font-semibold hover:bg-slate-200 transition-colors break-all leading-relaxed"
                    onclick="copyToQuery(this.innerText)">OMEAN pegawai JADI gaji=8500000 DIMANA id = 101</div>
                </div>

                <div class="mb-4">
                  <div class="text-xs font-bold text-slate-700 mb-1">7. Miceun Data</div>
                  <div
                    class="cursor-pointer text-xs bg-slate-100 text-slate-700 border border-slate-200 px-2 py-2 rounded font-mono font-semibold hover:bg-slate-200 transition-colors break-all leading-relaxed"
                    onclick="copyToQuery(this.innerText)">MICEUN TI pegawai DIMANA id = 103</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Schema Tab -->
        <div id="tab-schema" class="tool-panel hidden">
          <h2 class="text-2xl font-bold text-slate-800 mb-6">Table Designer</h2>
          <div class="bg-white rounded-xl border border-slate-200 p-6 mb-6 shadow-sm">
            <form onsubmit="event.preventDefault(); buildAndSubmitSchema();">
              <div class="mb-4">
                <label class="block mb-1.5 font-medium text-sm text-slate-700">Table Name</label>
                <input type="text" id="builderTableName" placeholder="e.g. products" required
                  class="w-full px-3 py-2.5 border border-slate-300 rounded-md font-sans text-sm transition-colors focus:border-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/20">
              </div>

              <label class="block mb-2.5 font-medium text-sm text-slate-700">Columns</label>

              <div id="columnsContainer">
                <div class="col-row flex gap-2.5 mb-2.5 items-center">
                  <input type="text" placeholder="Name"
                    class="col-name flex-[2] px-3 py-2.5 border border-slate-300 rounded-md text-sm" required>
                  <select class="col-type flex-1 px-3 py-2.5 border border-slate-300 rounded-md text-sm"
                    onchange="handleTypeChange(this)">
                    <option value="int">INT (Angka)</option>
                    <option value="float">FLOAT (Desimal)</option>
                    <option value="string">STRING (Teks)</option>
                    <option value="text">TEXT (Panjang)</option>
                    <option value="bool">BOOL (T/F)</option>
                    <option value="date">DATE (Tanggal)</option>
                    <option value="enum">ENUM (Pilihan)</option>
                    <option value="char">CHAR (Fixed)</option>
                  </select>
                  <input type="text"
                    class="col-args flex-1 px-3 py-2.5 border border-slate-300 rounded-md text-sm hidden"
                    placeholder="Detail...">
                  <button type="button"
                    class="btn-icon bg-red-50 text-red-500 border border-red-200 w-10 h-10 flex items-center justify-center rounded-md cursor-pointer opacity-50"
                    disabled>×</button>
                </div>
              </div>

              <button type="button" onclick="addNewColumnRow()"
                class="w-full border-2 border-dashed border-slate-300 bg-transparent py-3 rounded-lg text-slate-500 font-medium cursor-pointer mb-5 transition-all hover:border-indigo-600 hover:text-indigo-600 hover:bg-indigo-50">+
                Add Another Column</button>
              <button type="submit"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2.5 px-5 rounded-md cursor-pointer transition-colors">Create
                Table</button>
            </form>
            <div id="schemaBuilderAlert"></div>

            <div id="insertDataContainer" class="insert-container mt-7 border-t border-slate-200 pt-6 hidden"></div>

          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="/static/js/api.js"></script>
  <script src="/static/js/db.js"></script>
  <script src="/static/js/query.js"></script>
  <script src="/static/js/auth.js"></script>
  <script src="/static/js/ai-assistant.js"></script>

  <script>
    // --- 1. PERSISTENCE HELPERS ---
    function saveState(key, value) { localStorage.setItem(key, value); }
    function loadState(key) { return localStorage.getItem(key); }

    // --- 2. UI LOGIC (RESTORED LEGACY) ---
    function toggleSidebar() {
      document.querySelector('.sidebar').classList.toggle('-translate-x-full');
      document.querySelector('.overlay').classList.toggle('hidden');
      document.querySelector('.overlay').classList.toggle('block');
    }

    function switchTab(tabName) {
      if (window.innerWidth <= 768) toggleSidebar();

      // Hide all panels
      document.querySelectorAll('.tool-panel').forEach(p => {
        p.classList.add('hidden');
        p.classList.remove('block', 'animate-fade-in');
      });

      // Reset nav items
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active', 'bg-indigo-600', 'text-white'));

      // Show target panel
      const target = document.getElementById('tab-' + tabName);
      if (target) {
        target.classList.remove('hidden');
        target.classList.add('block', 'animate-fade-in');
      }

      const index = ['dashboard', 'database', 'query', 'schema'].indexOf(tabName);
      if (index >= 0) {
        const navItem = document.querySelectorAll('.nav-item')[index];
        navItem.classList.add('active', 'bg-indigo-600', 'text-white');
      }
    }

    window.onload = async () => {
      // Restore Lucide Icons (AI Widget might need them)
      if (window.lucide) lucide.createIcons();

      const msg = await whoami();
      if (msg) {
        document.getElementById('userName').innerText = "Admin";
        document.getElementById('userRole').innerText = msg;
        const colors = ['#f59e0b', '#10b981', '#6366f1', '#ec4899'];
        document.querySelector('.user-avatar') ? document.querySelector('.user-avatar').style.background = colors[Math.floor(Math.random() * colors.length)] : null;
      }

      // Restore State
      const lastDB = loadState('maung_active_db');
      if (lastDB && lastDB !== 'null') {
        document.getElementById('dbIndicator').classList.add('bg-emerald-500', 'shadow-[0_0_0_2px_rgba(16,185,129,0.2)]');
        document.getElementById('dbIndicator').classList.remove('bg-gray-300');
        document.getElementById('activeDBName').innerText = lastDB;
        try { await API.post("/db/use", { database: lastDB }); } catch (e) { }
      }
      document.getElementById('statTables').innerText = loadState('maung_stat_tables') || 0;
      document.getElementById('statQueries').innerText = loadState('maung_stat_queries') || 0;

      document.querySelectorAll('.chart-col').forEach(col => {
        col.style.height = (Math.floor(Math.random() * 60) + 20) + '%';
      });
    };

    const originalRunQuery = window.runQuery;
    window.runQuery = async function () {
      await originalRunQuery();
      let newCount = parseInt(document.getElementById('statQueries').innerText) + 1;
      document.getElementById('statQueries').innerText = newCount;
      saveState('maung_stat_queries', newCount);
    }

    const originalDoUseDB = window.doUseDB;
    window.doUseDB = async function () {
      await originalDoUseDB();
      const currentDB = document.getElementById('activeDBName').innerText;
      if (currentDB && currentDB !== 'No Database Selected' && currentDB !== 'Belum dipilih') {
        saveState('maung_active_db', currentDB);
      }
    }

    // --- 3. SCHEMA BUILDER LOGIC (RESTORED) ---

    function addNewColumnRow() {
      const container = document.getElementById('columnsContainer');
      const div = document.createElement('div');
      div.className = 'col-row flex gap-2.5 mb-2.5 items-center';
      div.innerHTML = `
        <input type="text" placeholder="Name" class="col-name flex-[2] px-3 py-2.5 border border-slate-300 rounded-md text-sm" required>
        <select class="col-type flex-1 px-3 py-2.5 border border-slate-300 rounded-md text-sm" onchange="handleTypeChange(this)">
          <option value="int">INT</option>
          <option value="float">FLOAT</option>
          <option value="string">STRING</option>
          <option value="text">TEXT</option>
          <option value="bool">BOOL</option>
          <option value="date">DATE</option>
          <option value="enum">ENUM</option>
          <option value="char">CHAR</option>
        </select>
        <input type="text" class="col-args flex-1 px-3 py-2.5 border border-slate-300 rounded-md text-sm hidden" placeholder="Detail...">
        <button type="button" class="btn-icon bg-red-50 text-red-500 border border-red-200 w-10 h-10 flex items-center justify-center rounded-md cursor-pointer" onclick="this.parentElement.remove()">×</button>
      `;
      container.appendChild(div);
    }

    // Handle Tampilan Input Tambahan (Enum/Char)
    function handleTypeChange(selectElem) {
      const row = selectElem.parentElement;
      const argsInput = row.querySelector('.col-args');
      const val = selectElem.value;

      if (val === 'enum') {
        argsInput.classList.remove('hidden');
        argsInput.placeholder = 'Pria,Wanita';
        argsInput.required = true;
      } else if (val === 'char') {
        argsInput.classList.remove('hidden');
        argsInput.placeholder = 'Panjang (Cth: 5)';
        argsInput.required = true;
      } else {
        argsInput.classList.add('hidden');
        argsInput.required = false;
        argsInput.value = '';
      }
    }

    async function buildAndSubmitSchema() {
      const tableName = document.getElementById('builderTableName').value;
      const rows = document.querySelectorAll('.col-row');
      const alertBox = document.getElementById('schemaBuilderAlert');

      let fieldsArray = [];
      let isValid = true;

      rows.forEach(row => {
        const name = row.querySelector('.col-name').value;
        const type = row.querySelector('.col-type').value;
        const args = row.querySelector('.col-args').value;

        if (name) {
          if (type === 'enum' || type === 'char') {
            if (!args) {
              alert('Harap isi detail untuk kolom ' + name + ' (' + type + ')');
              isValid = false;
              return;
            }
            fieldsArray.push(`${name}:${type}(${args})`);
          } else {
            fieldsArray.push(`${name}:${type}`);
          }
        }
      });

      if (!isValid) return;

      const res = await API.post("/schema/create", { table: tableName, fields: fieldsArray });

      if (res.success) {
        alertBox.innerHTML = `<div class="p-3 rounded-md bg-emerald-50 text-emerald-800 mt-2.5 text-sm">✅ Table <b>${tableName}</b> created!</div>`;
        let count = parseInt(document.getElementById('statTables').innerText) + 1;
        document.getElementById('statTables').innerText = count;
        saveState('maung_stat_tables', count);

        generateInsertForm(tableName, fieldsArray);
      } else {
        alertBox.innerHTML = `<div class="p-3 rounded-md bg-red-50 text-red-800 mt-2.5 text-sm">❌ ${res.error}</div>`;
        document.getElementById('insertDataContainer').style.display = 'none';
      }
    }

    // --- 4. INSERT FORM GENERATOR (RESTORED) ---
    function generateInsertForm(tableName, fields) {
      const container = document.getElementById('insertDataContainer');
      container.style.display = 'block';
      container.classList.remove('hidden');

      let inputsHtml = '';
      fields.forEach((field, index) => {
        const separatorIdx = field.indexOf(':');
        const colName = field.substring(0, separatorIdx);
        const colTypeFull = field.substring(separatorIdx + 1).toUpperCase();

        let inputHtml = '';

        if (colTypeFull.startsWith('ENUM')) {
          const content = colTypeFull.substring(colTypeFull.indexOf('(') + 1, colTypeFull.lastIndexOf(')'));
          const options = content.split(',');

          let opts = options.map(o => `<option value="${o}">${o}</option>`).join('');
          inputHtml = `<select class="insert-input w-full px-3 py-2.5 border border-slate-300 rounded-md text-sm" required>${opts}</select>`;

        } else if (colTypeFull === 'BOOL') {
          inputHtml = `<select class="insert-input w-full px-3 py-2.5 border border-slate-300 rounded-md text-sm" required><option value="true">True</option><option value="false">False</option></select>`;

        } else if (colTypeFull === 'DATE') {
          inputHtml = `<input type="date" class="insert-input w-full px-3 py-2.5 border border-slate-300 rounded-md text-sm" required>`;

        } else if (colTypeFull === 'INT' || colTypeFull === 'FLOAT') {
          inputHtml = `<input type="number" step="any" class="insert-input w-full px-3 py-2.5 border border-slate-300 rounded-md text-sm" placeholder="0" required>`;

        } else {
          inputHtml = `<input type="text" class="insert-input w-full px-3 py-2.5 border border-slate-300 rounded-md text-sm" placeholder="..." required>`;
        }

        inputsHtml += `
          <div class="mb-4">
            <label class="block text-sm text-slate-600 mb-1">
                ${colName} <span class="text-[11px] uppercase opacity-70 bg-indigo-100 text-indigo-800 px-1 py-0.5 rounded ml-1">${colTypeFull}</span>
            </label>
            ${inputHtml}
          </div>
        `;
      });

      container.innerHTML = `
        <h3 class="text-indigo-600 font-bold mb-4">Insert Data into '${tableName}'</h3>
        <form onsubmit="event.preventDefault(); submitInsertData('${tableName}');">
          <div class="grid grid-cols-1 md:grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-4">${inputsHtml}</div>
          <button type="submit" class="mt-5 w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2.5 rounded-md transition-colors">+ Insert Row</button>
        </form>
        <div id="insertResult"></div>
      `;
    }

    async function submitInsertData(tableName) {
      const inputs = document.querySelectorAll('.insert-input');
      const values = Array.from(inputs).map(input => input.value);
      const dataString = values.join('|');
      const query = `simpen ${tableName} ${dataString}`;

      const resultDiv = document.getElementById('insertResult');
      resultDiv.innerHTML = '<div class="mt-2.5 text-slate-500">⏳ Inserting...</div>';

      const res = await API.post("/query", { query: query });

      if (res.success) {
        resultDiv.innerHTML = `<div class="p-3 rounded-md bg-emerald-50 text-emerald-800 mt-2.5 text-sm">✅ Data inserted!</div>`;
        inputs.forEach(input => {
          if (input.tagName === 'SELECT') input.selectedIndex = 0;
          else input.value = '';
        });
        let newCount = parseInt(document.getElementById('statQueries').innerText) + 1;
        document.getElementById('statQueries').innerText = newCount;
        saveState('maung_stat_queries', newCount);
      } else {
        resultDiv.innerHTML = `<div class="p-3 rounded-md bg-red-50 text-red-800 mt-2.5 text-sm">❌ ${res.error}</div>`;
      }
    }

    // Mobile menu button visibility
    if (window.innerWidth <= 768) {
      document.querySelector('.menu-btn').classList.remove('hidden');
      document.querySelector('.menu-btn').classList.add('block');
    }
  </script>
</body>

</html>